---
title: CloudflareのRailgunサービス
tags:
  - インターネット
categories: インターネット
top: 29
abbrlink: 84b87417
date: 2019-05-20 14:37:43
---
<!--more-->
{% note primary %}
    ## Railgun™配信元(はいしんもと)ネットワークオプティマイザー(optimism)
{% endnote %}
&emsp;&emsp;Railgunを使用すると、配信元サーバーとCloudflareネットワーク間(かん)の接続が最大限(さいだいげん)に高速化します。
Railgunは高画質(こうがしつ)映像(えいぞう)の圧縮(あっしゅく)に使用されているのと似ている方法を利用して、以前はキャッシュ(cache)不可能であったWebオブジェクトを最大99.6%圧縮(あっしゅく)します。これにより、パフォーマンス(PERFORMANCE)が平均200%向上(こうじょう)します。

{% note primary %}
    ## Railgunの特徴(とくちょう)
{% endnote %}
&emsp;&emsp;Railgunは各(かく)Cloudflareデータセンターと配信元(はいしんもと)サーバー間の接続(せつぞく)を高速化します。そのため、Cloudflareのキャッシュでは配信できないリクエストであっても非常(ひじょう)に高速で配信されます。
&emsp;&emsp;Cloudflareのサイトに送られるリクエストの約(やく)2/3は、Web閲覧者(えつらんしゃ)との距離(きょり)が物理的に最も近いデータセンターのキャッシュから直接配信されます。Cloudflareのデータセンターは世界中(せかいじゅう)にあるため、バンガロール、ブリスベン、バーミンガム、ボストンなどから閲覧する場合、実際(じっさい)の配信元Webサーバーが数千(すうせん)マイル離れている場所にあるとしても、Webページはすぐに配信されます。
&emsp;&emsp;WebサイトがWeb閲覧者(えつらんしゃ)の近くでホストされているように見せる機能は、Web閲覧を高速化させるために欠かせないCloudflareの機能です。米国でホストされているWebサイトであっても、英国からのアクセスが多い場合もあります。Cloudflareを使用(しよう)すると、サイトは英国のデータセンターから配信され、コスト上昇(じょうしょう)を招く速度の遅延(ちえん)を避けることができます。
&emsp;&emsp;ただし、Cloudflareに対するリクエストの残りの1/3は、処理(しょり)のために配信元(はいしんもと)サーバーに送信(そうしん)されてしまいます。この理由には、多くのWebページがキャッシュ不可能であることが挙げられます。その原因の1つには誤(ご)設定(せってい)があり、多くは、Webページが頻繁(ひんぱん)に変更される場合、または個別(こべつ)に設定されている場合です。
&emsp;&emsp;たとえば、ニュースの変更(へんこう)や最新情報がビジネスに不可欠なNew York Timesのホームページは、短時間(たんじかん)のキャッシュも困難(こんなん)です。また、Facebookのように個別(こべつ)に設定されたWebサイトでは、同じURLであっても、各ユーザーにはそれぞれ異なるページが表示(ひょうじ)されます。
&emsp;&emsp;Railgunはこれまでキャッシュ不可能であったWebページを高速化してキャッシュするために、集結(しゅうけつ)した技術を使用しています。そのため、配信元サーバーを参照(さんしょう)する必要がある場合でも、Webページは速やかに配信されます。また、ニュースサイトのように急速(きゅうそく)に変化するページや個別(こべつ)に設定されたコンテンツにも対応(たいおう)しています。
&emsp;&emsp;Cloudflareの調査(ちょうさ)によると、キャッシュ不可能なサイトはたくさんあるものの、実際(じっさい)の変化は非常(ひじょう)にゆっくりしたものです。たとえば、New York Timesのホームページは、1日を通してニュース記事が書き込まれるたびに変更(へんこう)されますが、ページの定型(ていけい)部分(ぶぶん)のHTMLはほぼ同じままであり、多くの記事は1日中フロント(front)ページにとどまっています。
&emsp;&emsp;個別に設定されたサイトでは、定形(ていけい)部分(ぶぶん)のHTMLは同じままで、コンテンツの小さな部分（ユーザーのTwitterタイムラインやFacebookニュースフィードなど）だけが変更されます。つまり、ページの不変(ふへん)部分(ぶぶん)が検(けん)出(しゅつ)され、差異(さい)だけが送信(そうしん)された場合、送信用にWebページを圧縮(あっしゅく)できる大きな見込みがあります。

{% note primary %}
    ## 仕組み
{% endnote %}
&emsp;&emsp;キャッシュにないWebページがCloudflareサーバーにリクエストされると、CloudflareはHTTP接続で配信元サーバーにページをリクエストします。この場合、Railgunが高速化と安全(あんぜん)を確保(かくほ)するのはHTTP接続(せつぞく)です。
&emsp;&emsp;RailgunはListenerとSenderという2つのソフトウェアコンポーネント(component)で構成されています。Railgun Listenerは、配信元サーバーのWebホストにインストールされます。これは、暗号化(あんごうか)されたバイナリ(Binary)のRailgunプロトコル(protocol)を使用してCloudflareからの標準的(ひょうじゅんてき)なサーバーとサービスリクエストで動作するソフトウェアの一部分(いちぶぶん)です。
&emsp;&emsp;Railgun Senderは世界中(せかいじゅう)のすべてのCloudflareデータセンターにインストールされ、Railgun Listenersとの接続を維持(いじ)します。
&emsp;&emsp;配信元サーバーでの処理(しょり)が必要なHTTPリクエストが到着(とうちゃく)した場合、CloudflareはRailgun対応(たいおう)のWebサイトかどうかを判断します。Railgun未対応の場合、標準(ひょうじゅん)HTTPが使用されますが、Railgun対応の場合はHTTPリクエストはRailgun Senderにルーティングされて処理されます。
&emsp;&emsp;Railgun Senderは、圧縮されたバイナリチャンク(chunk)にリクエストを変換し、対応するRailgun Listenerに送信します。Railgun Listenerはリクエストを処理し、配信元サーバーへのHTTPリクエストを実行(じっこう)します。配信元サーバーから見るとHTTP接続がCloudflareから直接送信されたかのように見えますが、ホスティングパートナーのインフラストラクチャ(infrastructure)内から送信されるため、リクエストにレイテンシー(Latency)が発生することはありません。
&emsp;&emsp;Railgunはページバージョン(version)の比較に基づく新しいキャッシュメカニズム(Mechanical )を使用して、インターネット経由(けいゆ)でRailgun Senderに送信する必要がある情報を判断します。このメカニズムを使用することで、Cloudflareは通常(つうじょう)99.6%の圧縮(あっしゅく)（例：100,000バイトのWebページを400バイトに圧縮）と700%以上の高速化を実現(じつげん)できます。実際に圧縮されたデータは小さくなることが多いため、バイナリのRailgunプロトコルを使用して、応答(おうとう)全体(ぜんたい)が1つのTCPパケット内に収まります(おさまります)。
&emsp;&emsp;Railgun接続はTLS(Transport Layer Security)によって保護されているため、それらを経由して送信されたリクエストは盗聴(とうちょう)されることはありません。接続は証明書(しょうめいしょ)によって保護されているため、中間者(ちゅうかんしゃ)攻撃(こうげき)は不可能です。Cloudflareと配信元(はいしんもと)サーバー間のTCP接続は維持されるため、TCP接続の始動(しどう)の遅れを発生(はっせい)させずに次のリクエストに再利用(さいりよう)できます。
&emsp;&emsp;Railgunリクエストは同じ接続に多重化(たじゅうか)され、非同期(ひどうき)で処理できます。これは、RailgunがTCP接続の使用をブロックや最大化(さいだいか)することなく、多くの同時(どうじ)リクエストを処理できることを意味します。
